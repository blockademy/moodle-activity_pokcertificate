/**
 * JavaScript for the cardPaginate_preview of the
 * add_random_form class.
 *
 * @module    mod_pokcertificate/cardPaginate
 * @package
 * @copyright 2023 Moodle India Information Solutions Pvt Ltd
 * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_pokcertificate/cardPaginate",["jquery","core/ajax","core/str","core/notification","core/templates","mod_pokcertificate/paged_content_factory"],(function($,Ajax,Str,Notification,Templates,PagedContentFactory){var ITEMS_PER_PAGE=6,targetID="",targetRoot="",SELECTORS={LOADING_ICON_CONTAINER:'[data-region="overlay-icon-container"]',PAGINATE_COUNT_CONTAINER:'[data-region="'+targetID+'-count-container"]',PAGINATE_LIST_CONTAINER:'[data-region="'+targetID+'-list-container"]'},showLoadingIcon=function(targetRoot){targetRoot.find(SELECTORS.LOADING_ICON_CONTAINER).removeClass("hidden")},hideLoadingIcon=function(targetRoot){targetRoot.find(SELECTORS.LOADING_ICON_CONTAINER).addClass("hidden")},requestMethod=function(options,dataoptions,filterdata){var request={methodname:options.methodName,args:{contextid:dataoptions.contextid,options:JSON.stringify(options),dataoptions:JSON.stringify(dataoptions),offset:options.offset,limit:options.perPage,filterdata:JSON.stringify(filterdata)}};return Ajax.call([request])[0]},reload=function(options,dataoptions,filterdata){return function(options){options.templateName,options.hasOwnProperty("targetID")&&(targetID=options.targetID,targetRoot=$("#"+targetID)),options.hasOwnProperty("perPage")&&"number"==typeof options.perPage&&(ITEMS_PER_PAGE=options.perPage),SELECTORS={LOADING_ICON_CONTAINER:'[data-region="overlay-icon-container"]',PAGINATE_COUNT_CONTAINER:'[data-region="'+targetID+'-count-container"]',PAGINATE_LIST_CONTAINER:'[data-region="'+targetID+'-list-container"]'}}(options),showLoadingIcon(targetRoot),options.offset=0,requestMethod(options,dataoptions,filterdata).then((function(response){var totalCount=response.totalcount;return response.records.length?function(options,dataoptions,totalCount,firstresponse,filterdata){return PagedContentFactory.createFromAjax(totalCount,ITEMS_PER_PAGE,(function(pagesData){return pagesData.map((function(pageData){var offset=pageData.offset,limit=pageData.limit;return options.offset=offset,options.limit=limit,offset>0?requestMethod(options,dataoptions,filterdata).then((function(response){return response.cardClass=options.cardClass,response.viewtypeCard=!1,"card"!=options.viewType&&"table"!=options.viewType||(response.viewtypeCard=!0),Templates.render(options.templateName,{response:response})})).fail(Notification.exception):(firstresponse.cardClass=options.cardClass,firstresponse.viewtypeCard=!1,"card"!=options.viewType&&"table"!=options.viewType||(firstresponse.viewtypeCard=!0),Templates.render(options.templateName,{response:firstresponse}))}))}),{controlPlacementBottom:!0,eventNamespace:"paginate-paged-content-"+options.targetID,persistentLimitKey:"paginate-paged-content-limit-key"})}(options,dataoptions,totalCount,response,filterdata):response.nodata?Templates.render(options.templateName,{response:response}):Str.get_string("no_data_available","mod_pokcertificate").then((function(s){return Templates.render("mod_pokcertificate/no-data",{name:s})}))})).then((function(html,js){targetRoot=$("#"+options.targetID);var paginatelistcontainer='[data-region="'+options.targetID+'-list-container"]',container=targetRoot.find(paginatelistcontainer);Templates.replaceNodeContents(container,html,js)})).always((function(){targetRoot=$("#"+options.targetID),hideLoadingIcon(targetRoot)})).fail(Notification.exception)};return{reload:reload,showLoadingIcon:showLoadingIcon,hideLoadingIcon:hideLoadingIcon,filteringData:function(e,submitid){var formdata=$("form#"+submitid).serializeArray();values=[],filterdatavalue=[],$.each(formdata,(function(i,field){if(valuedata=[],"_qf__filters_form"!=field.name&&"sesskey"!=field.name)if("options"==field.name||"dataoptions"==field.name)values[field.name]=field.value;else{var str=field.name;-1!=str.indexOf("[]")&&(field.name=str.substring(0,str.length-2)),"_qf__force_multiselect_submission"!=field.value&&(field.name in filterdatavalue?filterdatavalue[field.name]=filterdatavalue[field.name]+","+field.value:filterdatavalue[field.name]=field.value)}}));var filtervalue=$("#global_filter").val();return filtervalue&&(filterdatavalue[$("#global_filter").attr("name")]=filtervalue),optionsparsondata=JSON.parse(values.options),dataoptionsparsondata=JSON.parse(values.dataoptions),filterdataparsondata=$.extend({},filterdatavalue),$("#global_filter").attr("data-filterdata",JSON.stringify(filterdataparsondata)),reload(optionsparsondata,dataoptionsparsondata,filterdataparsondata)},resetingData:function(e,submitid){var formdata=$("form#"+submitid).serializeArray();values=[],filterdatavalue=[],$.each(formdata,(function(i,field){valuedata=[],"_qf__filters_form"!=field.name&&"sesskey"!=field.name&&("options"!=field.name&&"dataoptions"!=field.name||(values[field.name]=field.value))}));var filtervalue=$("#global_filter").val();filtervalue&&(filterdatavalue[$("#global_filter").attr("name")]=filtervalue),optionsparsondata=JSON.parse(values.options),dataoptionsparsondata=JSON.parse(values.dataoptions),filterdataparsondata=$.extend({},filterdatavalue),$("#global_filter").attr("data-filterdata","[]"),reload(optionsparsondata,dataoptionsparsondata,filterdataparsondata),$("form#"+submitid)[0].reset(),$("div.form-autocomplete-selection").html("")}}}));

//# sourceMappingURL=cardPaginate.min.js.map